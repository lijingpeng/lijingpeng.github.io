<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>kaggleä¹‹äººè„¸ç‰¹å¾è¯†åˆ« | Frank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Facial_Keypoints_Detection github code
facial-keypoints-detection, è¿™æ˜¯ä¸€ä¸ªäººè„¸è¯†åˆ«ä»»åŠ¡ï¼Œä»»åŠ¡æ˜¯è¯†åˆ«äººè„¸å›¾ç‰‡ä¸­çš„çœ¼ç›ã€é¼»å­ã€å˜´çš„ä½ç½®ã€‚è®­ç»ƒé›†åŒ…å«ä»¥ä¸‹15ä¸ªä½ç½®çš„åæ ‡ï¼Œè¡Œæœ«æ˜¯å›¾ç‰‡çš„åƒç´ å€¼ï¼Œå…±96*96ä¸ªåƒç´ å€¼ã€‚æµ‹è¯•é›†åªåŒ…å«å›¾ç‰‡çš„åƒç´ å€¼ã€‚
left_eye_center, right_eye_center, left_eye_inner">
<meta property="og:type" content="article">
<meta property="og:title" content="kaggleä¹‹äººè„¸ç‰¹å¾è¯†åˆ«">
<meta property="og:url" content="http://www.notehub.cn/2016/08/26/algo/kaggle/facial_keypoints/index.html">
<meta property="og:site_name" content="Frank">
<meta property="og:description" content="Facial_Keypoints_Detection github code
facial-keypoints-detection, è¿™æ˜¯ä¸€ä¸ªäººè„¸è¯†åˆ«ä»»åŠ¡ï¼Œä»»åŠ¡æ˜¯è¯†åˆ«äººè„¸å›¾ç‰‡ä¸­çš„çœ¼ç›ã€é¼»å­ã€å˜´çš„ä½ç½®ã€‚è®­ç»ƒé›†åŒ…å«ä»¥ä¸‹15ä¸ªä½ç½®çš„åæ ‡ï¼Œè¡Œæœ«æ˜¯å›¾ç‰‡çš„åƒç´ å€¼ï¼Œå…±96*96ä¸ªåƒç´ å€¼ã€‚æµ‹è¯•é›†åªåŒ…å«å›¾ç‰‡çš„åƒç´ å€¼ã€‚
left_eye_center, right_eye_center, left_eye_inner">
<meta property="og:updated_time" content="2016-08-28T06:47:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kaggleä¹‹äººè„¸ç‰¹å¾è¯†åˆ«">
<meta name="twitter:description" content="Facial_Keypoints_Detection github code
facial-keypoints-detection, è¿™æ˜¯ä¸€ä¸ªäººè„¸è¯†åˆ«ä»»åŠ¡ï¼Œä»»åŠ¡æ˜¯è¯†åˆ«äººè„¸å›¾ç‰‡ä¸­çš„çœ¼ç›ã€é¼»å­ã€å˜´çš„ä½ç½®ã€‚è®­ç»ƒé›†åŒ…å«ä»¥ä¸‹15ä¸ªä½ç½®çš„åæ ‡ï¼Œè¡Œæœ«æ˜¯å›¾ç‰‡çš„åƒç´ å€¼ï¼Œå…±96*96ä¸ªåƒç´ å€¼ã€‚æµ‹è¯•é›†åªåŒ…å«å›¾ç‰‡çš„åƒç´ å€¼ã€‚
left_eye_center, right_eye_center, left_eye_inner">
  
  
    <link rel="icon" href="favicon.png">
  
  <link href='//fonts.css.network/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  <link href="//fonts.css.network/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  

  
</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/css/images/logo.jpg)"></i><span class="site-title">Frank</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/logo.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://www.notehub.cn"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/categories">Categories</a></td>
        
          <td><a class="main-nav-link" href="/tags">Tags</a></td>
        
          <td><a class="main-nav-link" href="/about">About</a></td>
        
        <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.notehub.cn"></form>
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <img id="avatar" src="/css/images/logo.png">
      <h2 id="name">Li Jingpeng</h2>
      <!-- <h3 id="title">undefined</h3> -->
      <span id="location"><i class="fa fa-map-marker"></i>Hangzhou, China</span>
      <a id="follow" href="Https://weibo.com/329299516">å…³æ³¨æˆ‘</a>
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        104
        <span>æ–‡ç« </span>
      </div>
      <div class="article-info-block">
        42
        <span>æ ‡ç­¾</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="https://github.com/lijingpeng" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="#" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
          <td><a href="#" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
          
          <td><a href="/me@lijingpeng.org" target="_blank" title="email"><i class="fa fa-email"></i></a></td>
          
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
          
        </tr>
      </table>
    </div>
    
    
  </div>
</aside>

      
      <section id="main"><article id="post-algo/kaggle/facial_keypoints" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      kaggleä¹‹äººè„¸ç‰¹å¾è¯†åˆ«
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2016/08/26/algo/kaggle/facial_keypoints/">
      <time datetime="2016-08-26T05:48:13.000Z" itemprop="datePublished">2016-08-26</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/kaggle/">kaggle</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p><a href="https://github.com/lijingpeng/kaggle/tree/master/competitions/Facial_Keypoints_Detection" target="_blank" rel="external">Facial_Keypoints_Detection github code</a></p>
<p><a href="https://www.kaggle.com/c/facial-keypoints-detection" target="_blank" rel="external">facial-keypoints-detection</a>, è¿™æ˜¯ä¸€ä¸ªäººè„¸è¯†åˆ«ä»»åŠ¡ï¼Œä»»åŠ¡æ˜¯è¯†åˆ«äººè„¸å›¾ç‰‡ä¸­çš„çœ¼ç›ã€é¼»å­ã€å˜´çš„ä½ç½®ã€‚è®­ç»ƒé›†åŒ…å«ä»¥ä¸‹15ä¸ªä½ç½®çš„åæ ‡ï¼Œè¡Œæœ«æ˜¯å›¾ç‰‡çš„åƒç´ å€¼ï¼Œå…±96*96ä¸ªåƒç´ å€¼ã€‚æµ‹è¯•é›†åªåŒ…å«å›¾ç‰‡çš„åƒç´ å€¼ã€‚</p>
<pre><code>left_eye_center, right_eye_center, left_eye_inner_corner, left_eye_outer_corner, right_eye_inner_corner, right_eye_outer_corner, left_eyebrow_inner_end, left_eyebrow_outer_end, right_eyebrow_inner_end, right_eyebrow_outer_end, nose_tip, mouth_left_corner, mouth_right_corner, mouth_center_top_lip, mouth_center_bottom_lip
</code></pre><pre><code class="python">import cPickle as pickle
from datetime import datetime
import os
import sys

import numpy as np
import pandas as pd
from lasagne import layers
from nolearn.lasagne import BatchIterator
from nolearn.lasagne import NeuralNet
from pandas.io.parsers import read_csv
from sklearn.utils import shuffle
import theano
</code></pre>
<pre><code>/Library/Python/2.7/site-packages/theano/tensor/signal/downsample.py:6: UserWarning: downsample module has been moved to the theano.tensor.signal.pool module.
  &quot;downsample module has been moved to the theano.tensor.signal.pool module.&quot;)
</code></pre><h2 id="u6570_u636E_u8F7D_u5165_u4E0E_u9884_u89C8"><a href="#u6570_u636E_u8F7D_u5165_u4E0E_u9884_u89C8" class="headerlink" title="æ•°æ®è½½å…¥ä¸é¢„è§ˆ"></a>æ•°æ®è½½å…¥ä¸é¢„è§ˆ</h2><pre><code class="python">train_file = &#39;training.csv&#39;
test_file = &#39;test.csv&#39;

def load(test=False, cols=None):
    &quot;&quot;&quot;
    è½½å…¥æ•°æ®ï¼Œé€šè¿‡å‚æ•°æ§åˆ¶è½½å…¥è®­ç»ƒé›†è¿˜æ˜¯æµ‹è¯•é›†ï¼Œå¹¶ç­›é€‰ç‰¹å¾åˆ—
    &quot;&quot;&quot;
    fname = test_file if test else train_file
    df = pd.read_csv(os.path.expanduser(fname))

    # å°†å›¾åƒæ•°æ®è½¬æ¢ä¸ºæ•°ç»„
    df[&#39;Image&#39;] = df[&#39;Image&#39;].apply(lambda x: np.fromstring(x, sep=&#39; &#39;))

    # ç­›é€‰æŒ‡å®šçš„æ•°æ®åˆ—
    if cols:  
        df = df[list(cols) + [&#39;Image&#39;]]

    print(df.count())  # æ¯åˆ—çš„ç®€å•ç»Ÿè®¡
    df = df.dropna()  # åˆ é™¤ç©ºæ•°æ®

    # å½’ä¸€åŒ–åˆ°0åˆ°1
    X = np.vstack(df[&#39;Image&#39;].values) / 255.  
    X = X.astype(np.float32)

    # é’ˆå¯¹è®­ç»ƒé›†ç›®æ ‡æ ‡ç­¾è¿›è¡Œå½’ä¸€åŒ–
    if not test:
        y = df[df.columns[:-1]].values
        y = (y - 48) / 48  
        X, y = shuffle(X, y, random_state=42)
        y = y.astype(np.float32)
    else:
        y = None

    return X, y
</code></pre>
<pre><code class="python"># å°†å•è¡Œåƒç´ æ•°æ®è½¬æ¢ä¸ºä¸‰ç»´çŸ©é˜µ
def load2d(test=False, cols=None):
    X, y = load(test=test, cols=cols)
    X = X.reshape(-1, 1, 96, 96)
    return X, y
</code></pre>
<h2 id="u6570_u636E_u5904_u7406"><a href="#u6570_u636E_u5904_u7406" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><p>ä¸€ç§æ–¹å¼æ˜¯æˆ‘ä»¬è®­ç»ƒä¸€ä¸ªåˆ†ç±»å™¨ï¼Œç”¨æ¥åˆ†ç±»æ‰€æœ‰çš„ç›®æ ‡ç‰¹å¾ã€‚å¦ä¸€ç§æ˜¯é’ˆå¯¹çœ¼é•œã€é¼»å­ã€å˜´åˆ†åˆ«è®¾ç½®ä¸åŒçš„åˆ†ç±»å™¨ï¼Œæ¯ä¸ªåˆ†ç±»å™¨åªé¢„æµ‹å•ä¸ªç›®æ ‡ã€‚é€šè¿‡è§‚å¯Ÿæ•°æ®æˆ‘ä»¬å‘ç°ï¼Œè®­ç»ƒé›†ä¸­æœ‰è®¸å¤šç¼ºå¤±æ•°æ®ï¼Œå¦‚æœè®­ç»ƒä¸€ä¸ªåˆ†ç±»å™¨ï¼Œåˆ æ‰ç¼ºå¤±æ•°æ®ä¼šè®©æˆ‘ä»¬çš„æ ·æœ¬é›†å˜å°ï¼Œä¸èƒ½å¾ˆå¥½åœ°åˆ©ç”¨èµ·æ•°æ®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒç§æ–¹å¼ï¼Œæ¯ä¸ªç›®æ ‡è®­ç»ƒä¸€ä¸ªåˆ†ç±»å™¨ï¼Œè¿™æ ·æ›´å¥½çš„åˆ©ç”¨æ ·æœ¬æ•°æ®ã€‚</p>
<pre><code class="python">from collections import OrderedDict
from sklearn.base import clone

SPECIALIST_SETTINGS = [
    dict(
        columns=(
            &#39;left_eye_center_x&#39;, &#39;left_eye_center_y&#39;,
            &#39;right_eye_center_x&#39;, &#39;right_eye_center_y&#39;,
            ),
        flip_indices=((0, 2), (1, 3)),
        ),

    dict(
        columns=(
            &#39;nose_tip_x&#39;, &#39;nose_tip_y&#39;,
            ),
        flip_indices=(),
        ),

    dict(
        columns=(
            &#39;mouth_left_corner_x&#39;, &#39;mouth_left_corner_y&#39;,
            &#39;mouth_right_corner_x&#39;, &#39;mouth_right_corner_y&#39;,
            &#39;mouth_center_top_lip_x&#39;, &#39;mouth_center_top_lip_y&#39;,
            ),
        flip_indices=((0, 2), (1, 3)),
        ),

    dict(
        columns=(
            &#39;mouth_center_bottom_lip_x&#39;,
            &#39;mouth_center_bottom_lip_y&#39;,
            ),
        flip_indices=(),
        ),

    dict(
        columns=(
            &#39;left_eye_inner_corner_x&#39;, &#39;left_eye_inner_corner_y&#39;,
            &#39;right_eye_inner_corner_x&#39;, &#39;right_eye_inner_corner_y&#39;,
            &#39;left_eye_outer_corner_x&#39;, &#39;left_eye_outer_corner_y&#39;,
            &#39;right_eye_outer_corner_x&#39;, &#39;right_eye_outer_corner_y&#39;,
            ),
        flip_indices=((0, 2), (1, 3), (4, 6), (5, 7)),
        ),

    dict(
        columns=(
            &#39;left_eyebrow_inner_end_x&#39;, &#39;left_eyebrow_inner_end_y&#39;,
            &#39;right_eyebrow_inner_end_x&#39;, &#39;right_eyebrow_inner_end_y&#39;,
            &#39;left_eyebrow_outer_end_x&#39;, &#39;left_eyebrow_outer_end_y&#39;,
            &#39;right_eyebrow_outer_end_x&#39;, &#39;right_eyebrow_outer_end_y&#39;,
            ),
        flip_indices=((0, 2), (1, 3), (4, 6), (5, 7)),
        ),
    ]
</code></pre>
<pre><code class="python">class FlipBatchIterator(BatchIterator):
    flip_indices = [
        (0, 2), (1, 3),
        (4, 8), (5, 9), (6, 10), (7, 11),
        (12, 16), (13, 17), (14, 18), (15, 19),
        (22, 24), (23, 25),
        ]

    def transform(self, Xb, yb):
        Xb, yb = super(FlipBatchIterator, self).transform(Xb, yb)

        # Flip half of the images in this batch at random:
        bs = Xb.shape[0]
        indices = np.random.choice(bs, bs / 2, replace=False)
        Xb[indices] = Xb[indices, :, :, ::-1]

        if yb is not None:
            # Horizontal flip of all x coordinates:
            yb[indices, ::2] = yb[indices, ::2] * -1

            # Swap places, e.g. left_eye_center_x -&gt; right_eye_center_x
            for a, b in self.flip_indices:
                yb[indices, a], yb[indices, b] = (
                    yb[indices, b], yb[indices, a])

        return Xb, yb
</code></pre>
<pre><code class="python">class EarlyStopping(object):
    def __init__(self, patience=100):
        self.patience = patience
        self.best_valid = np.inf
        self.best_valid_epoch = 0
        self.best_weights = None

    def __call__(self, nn, train_history):
        current_valid = train_history[-1][&#39;valid_loss&#39;]
        current_epoch = train_history[-1][&#39;epoch&#39;]
        if current_valid &lt; self.best_valid:
            self.best_valid = current_valid
            self.best_valid_epoch = current_epoch
            self.best_weights = nn.get_all_params_values()
        elif self.best_valid_epoch + self.patience &lt; current_epoch:
            print(&quot;Early stopping.&quot;)
            print(&quot;Best valid loss was {:.6f} at epoch {}.&quot;.format(
                self.best_valid, self.best_valid_epoch))
            nn.load_params_from(self.best_weights)
            raise StopIteration()
</code></pre>
<pre><code class="python">class AdjustVariable(object):
    def __init__(self, name, start=0.03, stop=0.001):
        self.name = name
        self.start, self.stop = start, stop
        self.ls = None

    def __call__(self, nn, train_history):
        if self.ls is None:
            self.ls = np.linspace(self.start, self.stop, nn.max_epochs)

        epoch = train_history[-1][&#39;epoch&#39;]
        new_value = np.cast[&#39;float32&#39;](self.ls[epoch - 1])
        getattr(nn, self.name).set_value(new_value)
</code></pre>
<pre><code class="python">def float32(k):
    return np.cast[&#39;float32&#39;](k)

net = NeuralNet(
    layers=[
        (&#39;input&#39;, layers.InputLayer),
        (&#39;conv1&#39;, layers.Conv2DLayer),
        (&#39;pool1&#39;, layers.MaxPool2DLayer),
        (&#39;dropout1&#39;, layers.DropoutLayer),
        (&#39;conv2&#39;, layers.Conv2DLayer),
        (&#39;pool2&#39;, layers.MaxPool2DLayer),
        (&#39;dropout2&#39;, layers.DropoutLayer),
        (&#39;conv3&#39;, layers.Conv2DLayer),
        (&#39;pool3&#39;, layers.MaxPool2DLayer),
        (&#39;dropout3&#39;, layers.DropoutLayer),
        (&#39;hidden4&#39;, layers.DenseLayer),
        (&#39;dropout4&#39;, layers.DropoutLayer),
        (&#39;hidden5&#39;, layers.DenseLayer),
        (&#39;output&#39;, layers.DenseLayer),
        ],
    input_shape=(None, 1, 96, 96),
    conv1_num_filters=32, conv1_filter_size=(3, 3), pool1_pool_size=(2, 2),
    dropout1_p=0.1,
    conv2_num_filters=64, conv2_filter_size=(2, 2), pool2_pool_size=(2, 2),
    dropout2_p=0.2,
    conv3_num_filters=128, conv3_filter_size=(2, 2), pool3_pool_size=(2, 2),
    dropout3_p=0.3,
    hidden4_num_units=300,
    dropout4_p=0.5,
    hidden5_num_units=300,
    output_num_units=30, output_nonlinearity=None,

    update_learning_rate=theano.shared(float32(0.03)),
    update_momentum=theano.shared(float32(0.9)),

    regression=True,
    batch_iterator_train = BatchIterator(batch_size = 100),
    batch_iterator_test = BatchIterator(batch_size = 100),
#     batch_iterator_train=FlipBatchIterator(batch_size=128),
#     on_epoch_finished=[
#         AdjustVariable(&#39;update_learning_rate&#39;, start=0.03, stop=0.0001),
#         AdjustVariable(&#39;update_momentum&#39;, start=0.9, stop=0.999),
#         EarlyStopping(patience=200),
#         ],
    max_epochs=10,
    verbose=1,
)
</code></pre>
<pre><code class="python">def fit_specialists(fname_pretrain=None):
    if fname_pretrain:
        with open(fname_pretrain, &#39;rb&#39;) as f:
            net_pretrain = pickle.load(f)
    else:
        net_pretrain = None

    specialists = OrderedDict()

    for setting in SPECIALIST_SETTINGS:
        cols = setting[&#39;columns&#39;]
        X, y = load2d(cols=cols)

        model = clone(net)
        model.output_num_units = y.shape[1]
        model.batch_iterator_train.flip_indices = setting[&#39;flip_indices&#39;]
        model.max_epochs = int(4e6 / y.shape[0])
        if &#39;kwargs&#39; in setting:
            # an option &#39;kwargs&#39; in the settings list may be used to
            # set any other parameter of the net:
            vars(model).update(setting[&#39;kwargs&#39;])

        if net_pretrain is not None:
            # if a pretrain model was given, use it to initialize the
            # weights of our new specialist model:
            model.load_params_from(net_pretrain)

        print(&quot;Training model for columns {} for {} epochs&quot;.format(
            cols, model.max_epochs))
        model.fit(X, y)
        specialists[cols] = model

    with open(&#39;net-specialists.pickle&#39;, &#39;wb&#39;) as f:
        # this time we&#39;re persisting a dictionary with all models:
        pickle.dump(specialists, f, -1)
</code></pre>
<pre><code class="python">def predict(fname_specialists=&#39;net-specialists.pickle&#39;):
    with open(fname_specialists, &#39;rb&#39;) as f:
        specialists = pickle.load(f)

    X = load2d(test=True)[0]
    y_pred = np.empty((X.shape[0], 0))

    for model in specialists.values():
        y_pred1 = model.predict(X)
        y_pred = np.hstack([y_pred, y_pred1])

    columns = ()
    for cols in specialists.keys():
        columns += cols

    y_pred2 = y_pred * 48 + 48
    y_pred2 = y_pred2.clip(0, 96)
    df = DataFrame(y_pred2, columns=columns)

    lookup_table = read_csv(os.path.expanduser(FLOOKUP))
    values = []

    for index, row in lookup_table.iterrows():
        values.append((
            row[&#39;RowId&#39;],
            df.ix[row.ImageId - 1][row.FeatureName],
            ))

    now_str = datetime.now().isoformat().replace(&#39;:&#39;, &#39;-&#39;)
    submission = DataFrame(values, columns=(&#39;RowId&#39;, &#39;Location&#39;))
    filename = &#39;submission-{}.csv&#39;.format(now_str)
    submission.to_csv(filename, index=False)
    print(&quot;Wrote {}&quot;.format(filename))
</code></pre>
<pre><code class="python">if __name__ == &#39;__main__&#39;:
    fit_specialists()
    predict()
</code></pre>
<pre><code>left_eye_center_x     7039
left_eye_center_y     7039
right_eye_center_x    7036
right_eye_center_y    7036
Image                 7049
dtype: int64
Training model for columns (&#39;left_eye_center_x&#39;, &#39;left_eye_center_y&#39;, &#39;right_eye_center_x&#39;, &#39;right_eye_center_y&#39;) for 568 epochs


/Library/Python/2.7/site-packages/lasagne/layers/conv.py:489: UserWarning: The `image_shape` keyword argument to `tensor.nnet.conv2d` is deprecated, it has been renamed to `input_shape`.
  border_mode=border_mode)


# Neural Network with 4779676 learnable parameters

## Layer information

  #  name      size
---  --------  ---------
  0  input     1x96x96
  1  conv1     32x94x94
  2  pool1     32x47x47
  3  dropout1  32x47x47
  4  conv2     64x46x46
  5  pool2     64x23x23
  6  dropout2  64x23x23
  7  conv3     128x22x22
  8  pool3     128x11x11
  9  dropout3  128x11x11
 10  hidden4   300
 11  dropout4  300
 12  hidden5   300
 13  output    4

# Neural Network with 4779676 learnable parameters

## Layer information

  #  name      size
---  --------  ---------
  0  input     1x96x96
  1  conv1     32x94x94
  2  pool1     32x47x47
  3  dropout1  32x47x47
  4  conv2     64x46x46
  5  pool2     64x23x23
  6  dropout2  64x23x23
  7  conv3     128x22x22
  8  pool3     128x11x11
  9  dropout3  128x11x11
 10  hidden4   300
 11  dropout4  300
 12  hidden5   300
 13  output    4

  epoch    trn loss    val loss    trn/val  dur
-------  ----------  ----------  ---------  -------
      1     [36m0.01113[0m     [32m0.00475[0m    2.34387  181.86s
  epoch    trn loss    val loss    trn/val  dur
-------  ----------  ----------  ---------  -------
      1     [36m0.01113[0m     [32m0.00475[0m    2.34387  181.86s
</code></pre><h3 id="Warning"><a href="#Warning" class="headerlink" title="Warning"></a>Warning</h3><p>å•æœºæ‰§è¡Œå®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨Amazon AWSçš„GPUå®ä¾‹æ¥è¿è¡Œç¨‹åºï¼Œåˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹å‚è§ï¼š<a href="https://www.kaggle.com/c/facial-keypoints-detection/details/deep-learning-tutorial" target="_blank" rel="external">deep-learning-tutorial</a></p>
<p>åœ¨è¿è¡Œå®ä¾‹ä¹‹åè¿˜æœ‰å‡ ç‚¹è¦åšï¼š</p>
<ol>
<li>å®‰è£…python pip &gt; sudo apt-get install python-pip python-dev build-essential   </li>
<li>åˆ›å»ºKaggle cookiesæ–‡ä»¶ï¼Œä¸ºäº†ä¸‹è½½è®­ç»ƒå’Œæµ‹è¯•æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†æœ¬åœ°æµè§ˆå™¨ä¸­çš„cookieså¯¼å‡ºï¼Œé€šè¿‡chrome æ’ä»¶ï¼š<a href="https://chrome.google.com/webstore/detail/cookietxt-export/lopabhfecdfhgogdbojmaicoicjekelh/related" target="_blank" rel="external">https://chrome.google.com/webstore/detail/cookietxt-export/lopabhfecdfhgogdbojmaicoicjekelh/related</a>   </li>
<li>æŠŠGithubä¸­çš„<a href="https://github.com/wendykan/AWSGPU_DeepLearning" target="_blank" rel="external">https://github.com/wendykan/AWSGPU_DeepLearning</a> cloneåˆ°ä½ çš„AWSå®ä¾‹ä¸­ï¼Œè¿›è¡Œä¸€äº›æœºå™¨å­¦ä¹ çš„åˆå§‹åŒ–å·¥ä½œã€‚  </li>
</ol>
<p>ä¸€äº›å‚è€ƒï¼š<br><a href="http://ramhiser.com/2016/01/05/installing-tensorflow-on-an-aws-ec2-instance-with-gpu-support/" target="_blank" rel="external">http://ramhiser.com/2016/01/05/installing-tensorflow-on-an-aws-ec2-instance-with-gpu-support/</a><br><a href="http://danielnouri.org/notes/2014/12/17/using-convolutional-neural-nets-to-detect-facial-keypoints-tutorial/" target="_blank" rel="external">http://danielnouri.org/notes/2014/12/17/using-convolutional-neural-nets-to-detect-facial-keypoints-tutorial/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.notehub.cn/2016/08/26/algo/kaggle/facial_keypoints/" data-id="cit81zufi006l7hs88dm2ahat" class="article-share-link">åˆ†äº«åˆ°</a>
      
        <a href="http://www.notehub.cn/2016/08/26/algo/kaggle/facial_keypoints/#ds-thread" class="article-comment-link">è¯„è®º</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kaggle/">kaggle</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/31/dev/python/python_print_chs/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          Python print ä¸­æ–‡ä¹±ç é—®é¢˜
        
      </div>
    </a>
  
  
    <a href="/2016/08/25/algo/ml/hmm_crf/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">ä¸€å¼ å…³äºè´å¶æ–¯ã€HMMã€CRFçš„å›¾</div>
    </a>
  
</nav>


  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="http://www.notehub.cn/2016/08/26/algo/kaggle/facial_keypoints/" data-title="kaggleä¹‹äººè„¸ç‰¹å¾è¯†åˆ«" data-url="http://www.notehub.cn/2016/08/26/algo/kaggle/facial_keypoints/">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by DuoShuo.</a></noscript>
      </div>
  </section>

</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/09/14/algo/one_hot_encode/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/machine-learning/">machine learning</a></p>
              <p class="item-title"><a href="/2016/09/14/algo/one_hot_encode/" class="title">One-Hot Encoding</a></p>
              <p class="item-date"><time datetime="2016-09-13T16:00:00.000Z" itemprop="datePublished">2016-09-14</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/09/12/system/linux_grep/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/system/">system</a></p>
              <p class="item-title"><a href="/2016/09/12/system/linux_grep/" class="title">LinuxæŸ¥æ‰¾æ–‡ä»¶å†…å®¹ï¼ˆgrepï¼‰</a></p>
              <p class="item-date"><time datetime="2016-09-11T16:00:00.000Z" itemprop="datePublished">2016-09-12</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/09/11/other/public_cdn/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/other/">other</a></p>
              <p class="item-title"><a href="/2016/09/11/other/public_cdn/" class="title">CDNJS åº“ä»¥åŠ Google Fontsã€Ajax å’Œ Gravatar åä»£</a></p>
              <p class="item-date"><time datetime="2016-09-10T16:00:00.000Z" itemprop="datePublished">2016-09-11</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/09/09/algo/kaggle/gbid/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/kaggle/">kaggle</a></p>
              <p class="item-title"><a href="/2016/09/09/algo/kaggle/gbid/" class="title">kaggleä¹‹Grupo Bimbo Inventory Demand</a></p>
              <p class="item-date"><time datetime="2016-09-09T05:48:13.000Z" itemprop="datePublished">2016-09-09</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/09/08/dev/python/pandas_reset_index/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/dev/">dev</a></p>
              <p class="item-title"><a href="/2016/09/08/dev/python/pandas_reset_index/" class="title">pandas reset_index</a></p>
              <p class="item-date"><time datetime="2016-09-08T02:19:56.000Z" itemprop="datePublished">2016-09-08</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hadoop/">Hadoop</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hash/">Hash</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hive/">Hive</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Photo/">Photo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ads/">ads</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dev/">dev</a><span class="category-list-count">31</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/github/">github</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/internet/">internet</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kaggle/">kaggle</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/machine-learning/">machine learning</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sklearn/">sklearn</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/system/">system</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/travel/">travel</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget tagcloud">
      <a href="/tags/Apache/" style="font-size: 10px;">Apache</a> <a href="/tags/Bandits/" style="font-size: 12.5px;">Bandits</a> <a href="/tags/Elasticsearch-docker/" style="font-size: 10px;">Elasticsearch, docker</a> <a href="/tags/FlatBuffers/" style="font-size: 10px;">FlatBuffers</a> <a href="/tags/Google/" style="font-size: 10px;">Google</a> <a href="/tags/Granger-causality/" style="font-size: 10px;">Granger causality</a> <a href="/tags/GridSearchCV/" style="font-size: 10px;">GridSearchCV</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Jquery/" style="font-size: 10px;">Jquery</a> <a href="/tags/MapReduce/" style="font-size: 10px;">MapReduce</a> <a href="/tags/Mock/" style="font-size: 10px;">Mock</a> <a href="/tags/Monument-Vallay/" style="font-size: 10px;">Monument Vallay</a> <a href="/tags/Mysql/" style="font-size: 12.5px;">Mysql</a> <a href="/tags/PPTP-vpn/" style="font-size: 12.5px;">PPTP, vpn</a> <a href="/tags/Photoshop/" style="font-size: 10px;">Photoshop</a> <a href="/tags/Pipeline/" style="font-size: 10px;">Pipeline</a> <a href="/tags/Shadowsocks/" style="font-size: 10px;">Shadowsocks</a> <a href="/tags/ad/" style="font-size: 10px;">ad</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/blade/" style="font-size: 10px;">blade</a> <a href="/tags/crontab/" style="font-size: 10px;">crontab</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/elasticsearch/" style="font-size: 12.5px;">elasticsearch</a> <a href="/tags/font/" style="font-size: 10px;">font</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/go/" style="font-size: 17.5px;">go</a> <a href="/tags/hashmap/" style="font-size: 10px;">hashmap</a> <a href="/tags/kaggle/" style="font-size: 20px;">kaggle</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/linux-ldd-ä¾èµ–å…³ç³»/" style="font-size: 10px;">linux, ldd, ä¾èµ–å…³ç³»</a> <a href="/tags/lucene/" style="font-size: 10px;">lucene</a> <a href="/tags/nio/" style="font-size: 10px;">nio</a> <a href="/tags/pagerank/" style="font-size: 10px;">pagerank</a> <a href="/tags/photo/" style="font-size: 10px;">photo</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/swift-llvm/" style="font-size: 10px;">swift, llvm</a> <a href="/tags/å‰ç«¯/" style="font-size: 10px;">å‰ç«¯</a> <a href="/tags/å¹¿å‘Š/" style="font-size: 12.5px;">å¹¿å‘Š</a> <a href="/tags/å¼€æºï¼Œè®¸å¯/" style="font-size: 10px;">å¼€æºï¼Œè®¸å¯</a> <a href="/tags/æ¾³é—¨/" style="font-size: 10px;">æ¾³é—¨</a> <a href="/tags/ç›‘æ§ï¼Œzabbix/" style="font-size: 10px;">ç›‘æ§ï¼Œzabbix</a> <a href="/tags/è´å¶æ–¯/" style="font-size: 10px;">è´å¶æ–¯</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">ä¹æœˆ 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">å…«æœˆ 2016</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">äº”æœˆ 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">ä¸‰æœˆ 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">äºŒæœˆ 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">ä¸€æœˆ 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">åäºŒæœˆ 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">åä¸€æœˆ 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">åæœˆ 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">ä¹æœˆ 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">å…­æœˆ 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">äº”æœˆ 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">å››æœˆ 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">ä¸‰æœˆ 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">äºŒæœˆ 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">ä¸€æœˆ 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">åäºŒæœˆ 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">åä¸€æœˆ 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">åæœˆ 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">å…­æœˆ 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">åä¸€æœˆ 2013</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Li Jingpeng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script type="text/javascript">
  var duoshuoQuery = {short_name:"lijingpeng"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>


<script src="//ajax.css.network/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>